import{j as s}from"./ui-By_2Fhe3.js";import{e as T,r as o,L as R}from"./router-BpYP0_uS.js";import{l as D,s as x,t as u,C as f,d as g,B as m,R as J,F as j,a as L,b as U,c as E,y as F,z as B,G as Z,Z as z,A as C,m as _,e as k,D as V}from"./index-BH6X8p7N.js";import{C as H,M as i}from"./MetricCard-rv4kEdck.js";import{S}from"./StatusIndicator-CG_G960C.js";import{P as O}from"./ProgressBar-Ck4dMsKO.js";import{a as A,b as Q}from"./format-CI9fAwaI.js";import{C as b}from"./circle-check-big-Rr6Odbyy.js";import{T as q}from"./trash-2-DZdKPNx9.js";import"./vendor-9sitkZcQ.js";import"./clock-4hQwb6Kv.js";import"./status-CvdYEDDi.js";import"./trending-up-C2x3fOIe.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],K=D("scale",G);function M(r,t,l=0){if(r==null&&(r=0),t==null&&(t=0),t===0)return 0;const p=r/t*100;return W(X(p,l),0,100)}function W(r,t,l){return Math.min(Math.max(r,t),l)}function X(r,t=0){const l=Math.pow(10,t);return Math.round(r*l)/l}function me(){const[r]=T(),[t,l]=o.useState([]),[p,v]=o.useState(!0),[w,y]=o.useState(!1),d=o.useRef(null),h=r.get("jobId"),N=o.useCallback(async(e=!1)=>{e||v(!0),y(!e);try{const a=await x.getJobs();l(a),h&&!e&&setTimeout(()=>{const n=document.getElementById(`job-${h}`);n&&n.scrollIntoView({behavior:"smooth"})},100)}catch{u.error("Failed to fetch job status")}finally{v(!1),y(!1)}},[h]);o.useEffect(()=>{N();const e=setInterval(async()=>{try{const a=await x.getJobs();l(a),!a.some(c=>c.status==="processing"||c.status==="pending")&&d.current&&(clearInterval(d.current),d.current=null)}catch{}},3e3);return d.current=e,()=>{d.current&&clearInterval(d.current)}},[]);const I=async e=>{try{const a=await x.downloadResults(e.id),n=window.URL.createObjectURL(a),c=document.createElement("a");c.style.display="none",c.href=n,c.download=`processed_${e.filename}`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(n),document.body.removeChild(c),u.success("File downloaded successfully")}catch{u.error("Failed to download file")}},P=async e=>{try{await x.deleteJob(e.id),l(t.filter(a=>a.id!==e.id)),u.success("Job deleted successfully")}catch{u.error("Failed to delete job")}},$=e=>{if(e.status!=="processing")return"";const a=Date.now()-new Date(e.createdAt).getTime(),n=(e.totalRows||1e3)*50,c=Math.max(0,n-a);return Q(c)};return p?s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Processing Status"})}),s.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,a)=>s.jsx(f,{className:"animate-pulse",children:s.jsx(g,{className:"p-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-1/3"}),s.jsx("div",{className:"h-6 bg-muted rounded w-full"}),s.jsx("div",{className:"h-2 bg-muted rounded w-full"})]})})},a))})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Processing Status"}),s.jsx("p",{className:"text-muted-foreground",children:"Monitor your file processing jobs and download results. All files are automatically deleted after 10 minutes."})]}),s.jsxs(m,{onClick:()=>N(),disabled:w,variant:"outline",size:"sm",children:[s.jsx(J,{className:`h-4 w-4 mr-2 ${w?"animate-spin":""}`}),"Refresh"]})]}),t.length===0?s.jsx(f,{children:s.jsxs(g,{className:"p-12 text-center",children:[s.jsx(j,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No processing jobs"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload your first file to start processing names with AI"}),s.jsx(R,{to:"/dashboard/upload",children:s.jsx(m,{children:"Upload File"})})]})}):s.jsx("div",{className:"space-y-4",children:t.map(e=>s.jsxs(f,{id:`job-${e.id}`,className:h===e.id?"ring-2 ring-primary":"",role:"article","aria-label":`Processing job for ${e.filename}, ${e.status}, ${e.progress}% complete`,children:[s.jsxs(L,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(S,{status:e.status,mode:"icon",iconSize:"lg",animate:!0}),s.jsxs("div",{children:[s.jsx(U,{className:"text-xl",children:e.filename}),s.jsxs(E,{children:["Uploaded ",A(e.createdAt),e.completedAt&&e.status==="completed"&&s.jsxs("span",{children:[" • Completed ",A(e.completedAt)]})]})]})]}),s.jsx(S,{status:e.status,mode:"badge"})]}),(e.expiresAt||e.expires_at)&&s.jsx("div",{className:"mt-4",children:s.jsx(H,{expiresAt:e.expiresAt||e.expires_at||null,className:"w-full",showIcon:!0,warningThreshold:2})})]}),s.jsxs(g,{className:"space-y-4",children:[s.jsx(O,{value:e.progress,max:100,showLabel:!0,label:`Progress: ${e.progress}%${e.status==="processing"?` • ${$(e)}`:""}`,animated:e.status==="processing",dangerZone:95}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Rows"}),s.jsx("p",{className:"font-medium",children:e.totalRows?e.totalRows.toLocaleString():e.processedRows?e.processedRows.toLocaleString():"Processing..."})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Success Rate"}),s.jsx("p",{className:"font-medium",children:e.status==="completed"&&(e.successRate!==void 0||e.totalRows&&e.successfulParses!==void 0)?`${e.successRate!==void 0?Math.round(e.successRate):Math.round((e.successfulParses||0)/(e.totalRows||1)*100)}%`:"-"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Processed"}),s.jsx("p",{className:"font-medium",children:e.processedRows?e.processedRows.toLocaleString():"-"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-muted-foreground",children:"Job ID"}),s.jsxs("p",{className:"font-mono text-caption",children:[e.id.slice(0,8),"..."]})]})]}),e.status==="completed"&&e.analytics&&s.jsxs("div",{className:"border-t pt-4 mt-4",children:[s.jsx("h4",{className:"font-semibold mb-4",children:"Entity Type Analytics"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsx(i,{value:e.analytics.entity_stats?.person_count||0,label:"People",variant:"info",icon:F}),s.jsx(i,{value:e.analytics.entity_stats?.company_count||0,label:"Companies",variant:"success",icon:B}),s.jsx(i,{value:e.analytics.entity_stats?.trust_count||0,label:"Trusts",variant:"default",icon:K}),s.jsx(i,{value:e.analytics.entity_stats?.unknown_count||0,label:"Unknown",variant:"warning"}),s.jsx(i,{value:e.analytics.entity_stats?.error_count||0,label:"Errors",variant:"error"})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[s.jsx(i,{value:`${M(e.geminiSuccessCount,e.totalRows)}%`,label:"AI Success",variant:"info",icon:Z,formatValue:!1}),s.jsx(i,{value:`${M(e.fallbackUsageCount,e.totalRows)}%`,label:"Fallback Used",variant:"warning",icon:z,formatValue:!1}),s.jsx(i,{value:e.analytics.high_confidence_count||0,label:"High Quality",variant:"success",icon:b}),s.jsx(i,{value:e.analytics.avg_confidence?Math.round(e.analytics.avg_confidence*100):0,label:"Quality Score",variant:"info"})]}),e.analytics.low_confidence_count&&e.totalRows&&e.analytics.low_confidence_count/e.totalRows>.3&&s.jsxs(C,{className:"mt-4",variant:"default",children:[s.jsx(_,{className:"h-4 w-4"}),s.jsxs(k,{children:["High fallback usage detected (",Math.round(e.analytics.low_confidence_count/e.totalRows*100),"%). Consider checking the detailed results for quality concerns."]})]})]}),e.status==="failed"&&e.errorMessage&&s.jsxs(C,{variant:"destructive",children:[s.jsx(_,{className:"h-4 w-4"}),s.jsx(k,{children:e.errorMessage})]}),s.jsxs("div",{className:"flex gap-2",children:[e.status==="completed"&&s.jsxs(m,{onClick:()=>I(e),variant:"success",size:"default",children:[s.jsx(V,{className:"h-4 w-4 mr-2"}),"Download Results"]}),e.status==="completed"&&s.jsx(R,{to:`/dashboard/results?jobId=${e.id}`,children:s.jsxs(m,{variant:"secondary",className:"border border-primary-200 hover:border-primary-400",children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),"View Results"]})}),(e.status==="failed"||e.status==="completed")&&s.jsxs(m,{variant:"outline",onClick:()=>P(e),className:"text-destructive hover:text-destructive",children:[s.jsx(q,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]},e.id))})]})}export{me as default};
//# sourceMappingURL=ProcessingStatus-DIPSz0G9.js.map
