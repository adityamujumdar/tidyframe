import{j as e,c as be,v as oe,q as ye,l as je,w as Ce,m as ie,A as Ne,P as Te,n as k,k as ke,D as Re,x as Pe,y as Se,z as Ae}from"./ui-By_2Fhe3.js";import{r as c,e as Ee}from"./router-BpYP0_uS.js";import{l as Le,A as Ie,T as A,e as Me,C as M,a as $,b as G,J as De,c as B,B as D,d as J,o as S,G as le,Z as ce,M as Q,j as _e,y as X,F as de,S as Oe,N as Ue,U as qe,m as Fe,s as F,t as R,D as He,I as $e,p as Ge}from"./index-BH6X8p7N.js";import{M as I,C as Be}from"./MetricCard-rv4kEdck.js";import{P as Je}from"./ProgressBar-Ck4dMsKO.js";import{d as Qe,e as ze,f as We,h as Ve}from"./status-CvdYEDDi.js";import{C as Ye,a as Ze,R as Xe,S as Ke}from"./index-Dj2z-qXG.js";import{C as et}from"./circle-check-big-Rr6Odbyy.js";import{T as tt}from"./trending-up-C2x3fOIe.js";import{T as st,a as nt,b as K,c as N,d as at,e as T}from"./table-CNlI6l6g.js";import{E as ue,S as rt}from"./SkeletonCard-BDptt99D.js";import"./vendor-9sitkZcQ.js";import"./clock-4hQwb6Kv.js";import"./format-CI9fAwaI.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],it=Le("funnel",ot);function _(t){return t.warnings?.some(s=>s.toLowerCase().includes("fallback")||s.toLowerCase().includes("regex")||s.toLowerCase().includes("pattern"))||t.parsingConfidence<.6?"fallback":"gemini"}function H(t){const s=_(t),n=t.parsingConfidence;return s==="fallback"?n<.4?{level:"error",method:s,confidence:n,message:"Low quality fallback parsing",reason:"Gemini API failed, used regex fallback with very low confidence"}:n<.7?{level:"warning",method:s,confidence:n,message:"Fallback parsing used",reason:"Gemini API unavailable, used pattern-based fallback"}:{level:"info",method:s,confidence:n,message:"High-quality fallback parsing",reason:"Fallback parser achieved good results"}:s==="gemini"&&n<.7?{level:"warning",method:s,confidence:n,message:"Low confidence AI parsing",reason:"Gemini AI had difficulty parsing this text"}:null}function ee(t){return t>=.9?"text-status-success":t>=.7||t>=.5?"text-status-warning":"text-status-error"}function lt(t){return t==="gemini"?"bg-status-info-bg text-status-info border-status-info-border":"bg-status-warning-bg text-status-warning border-status-warning-border"}function te(t){switch(t){case"info":return"text-status-info";case"warning":return"text-status-warning";case"error":return"text-status-error";default:return"text-muted-foreground"}}function se(t){const s=t.toLowerCase();return s.includes("api")&&s.includes("limit")?"API rate limit reached - used backup parsing system":s.includes("api")&&s.includes("error")?"AI service temporarily unavailable - used pattern-based parsing":s.includes("timeout")?"AI processing timeout - switched to fast pattern parsing":s.includes("fallback")||s.includes("regex")?"Used pattern-based parsing (backup system)":s.includes("low confidence")?"AI had difficulty - confidence score below threshold":"Alternative parsing method used"}function ct(t){if(t.length===0)return{totalRows:0,geminiSuccessCount:0,fallbackCount:0,lowConfidenceCount:0,successRate:0,fallbackUsagePercentage:0,avgConfidence:0,qualityScore:0};let s=0,n=0,r=0,i=0;t.forEach(g=>{const b=_(g),y=g.parsingConfidence;b==="gemini"?s++:n++,y<.7&&r++,i+=y});const a=t.length,u=(t.length-r)/a,h=n/a,d=i/a,o=s/a*.4,l=d*.4,p=Math.max(0,1-r/a)*.2,w=(o+l+p)*100;return{totalRows:a,geminiSuccessCount:s,fallbackCount:n,lowConfidenceCount:r,successRate:u,fallbackUsagePercentage:h,avgConfidence:d,qualityScore:Math.round(w)}}function dt(t){const s=[];return t.fallbackUsagePercentage>.3&&s.push("High fallback usage detected. Consider checking your API key and quota limits."),t.avgConfidence<.7&&s.push("Low average confidence. Review and clean your input data for better results."),t.lowConfidenceCount>t.totalRows*.2&&s.push("Many low-confidence results. Consider preprocessing your data or using higher quality source text."),t.qualityScore<70&&s.push("Overall quality score is low. Review input data quality and API configuration."),s.length===0&&s.push("Great job! Your parsing results show high quality and minimal issues."),s}function ut(t){return t.fallbackUsagePercentage>.5?{show:!0,severity:"error",message:`Critical: ${Math.round(t.fallbackUsagePercentage*100)}% of results used fallback parsing. Check your API configuration.`}:t.fallbackUsagePercentage>.3||t.qualityScore<60?{show:!0,severity:"warning",message:`Quality concern: ${Math.round(t.fallbackUsagePercentage*100)}% fallback usage detected. Review results carefully.`}:{show:!1,severity:"warning",message:""}}function ft(t){const s=t.totalRows||t.processedRows||0,n=t.geminiSuccessCount||0,r=t.fallbackUsageCount||0,i=t.lowConfidenceCount||0,a=typeof t.qualityScore=="number"?t.qualityScore*100:0,u=t.analytics||t.stats||{},h=u.avg_confidence||0,d=u.success_rate?u.success_rate/100:1;return{totalRows:s,geminiSuccessCount:n,fallbackCount:r,lowConfidenceCount:i,successRate:d,fallbackUsagePercentage:s>0?r/s:0,avgConfidence:h,qualityScore:Math.round(a)}}function pt({results:t,job:s,className:n=""}){const[r,i]=c.useState(!1),a=s&&s.analytics?ft(s):ct(t),u=dt(a),h=ut(a);if(t.length===0)return null;const d=Qe(a.qualityScore);return e.jsxs("div",{className:`space-y-4 ${n}`,children:[h.show&&e.jsxs(Ie,{variant:h.severity==="error"?"destructive":"default",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(Me,{children:h.message})]}),e.jsxs(M,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Data Quality Report"]}),e.jsxs(B,{children:["Parsing quality and method analysis for ",a.totalRows.toLocaleString()," processed rows"]})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>i(!r),children:[r?e.jsx(Ye,{className:"h-4 w-4"}):e.jsx(Ze,{className:"h-4 w-4"}),r?"Collapse":"Expand"]})]})}),e.jsxs(J,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Overall Quality Score"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Combined parsing quality rating"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-3xl font-bold ${ze(a.qualityScore)}`,children:[a.qualityScore,"%"]}),e.jsx(S,{variant:Ve(a.qualityScore),children:We(a.qualityScore)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(I,{value:a.geminiSuccessCount,label:"AI Parsed",subtitle:`${Math.round(a.geminiSuccessCount/a.totalRows*100)}%`,variant:"info",icon:le}),e.jsx(I,{value:a.fallbackCount,label:"Fallback Used",subtitle:`${Math.round(a.fallbackUsagePercentage*100)}%`,variant:"warning",icon:ce}),e.jsx(I,{value:a.totalRows-a.lowConfidenceCount,label:"High Quality",subtitle:`${Math.round(a.successRate*100)}%`,variant:"success",icon:et}),e.jsx(I,{value:a.lowConfidenceCount,label:"Low Confidence",subtitle:`${Math.round(a.lowConfidenceCount/a.totalRows*100)}%`,variant:"error",icon:A})]}),e.jsx(Je,{value:a.avgConfidence*100,max:100,showLabel:!0,label:`Average Confidence: ${Math.round(a.avgConfidence*100)}%`,dangerZone:70,size:"sm",variant:a.avgConfidence*100>=85?"success":a.avgConfidence*100>=70?"primary":"warning"}),r&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(tt,{className:"h-4 w-4"}),"API Usage Breakdown"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Gemini API Success:"}),e.jsxs(S,{variant:"outline",className:"bg-status-info-bg border-status-info-border",children:[Math.round(a.geminiSuccessCount/a.totalRows*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Fallback Usage:"}),e.jsxs(S,{variant:"outline",className:"bg-status-warning-bg border-status-warning-border",children:[Math.round(a.fallbackUsagePercentage*100),"%"]})]})]})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Cost Analysis"}),e.jsxs("p",{className:"text-caption text-muted-foreground",children:["Fallback parsing saved approximately"," ",e.jsxs("span",{className:"font-medium text-status-success",children:["$",(a.fallbackCount*.001).toFixed(3)]})," ","in API costs (",a.fallbackCount," API calls avoided)"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Recommendations"]}),e.jsx("div",{className:"space-y-2",children:u.map((o,l)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-muted/50 rounded text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:o})]},l))})]})]})]})]})]})}var[O,Yt]=be("Tooltip",[oe]),U=oe(),fe="TooltipProvider",xt=700,z="tooltip.open",[mt,Y]=O(fe),pe=t=>{const{__scopeTooltip:s,delayDuration:n=xt,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:a}=t,u=c.useRef(!0),h=c.useRef(!1),d=c.useRef(0);return c.useEffect(()=>{const o=d.current;return()=>window.clearTimeout(o)},[]),e.jsx(mt,{scope:s,isOpenDelayedRef:u,delayDuration:n,onOpen:c.useCallback(()=>{window.clearTimeout(d.current),u.current=!1},[]),onClose:c.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>u.current=!0,r)},[r]),isPointerInTransitRef:h,onPointerInTransitChange:c.useCallback(o=>{h.current=o},[]),disableHoverableContent:i,children:a})};pe.displayName=fe;var E="Tooltip",[ht,q]=O(E),xe=t=>{const{__scopeTooltip:s,children:n,open:r,defaultOpen:i,onOpenChange:a,disableHoverableContent:u,delayDuration:h}=t,d=Y(E,t.__scopeTooltip),o=U(s),[l,p]=c.useState(null),w=ye(),g=c.useRef(0),b=u??d.disableHoverableContent,y=h??d.delayDuration,j=c.useRef(!1),[C,f]=je({prop:r,defaultProp:i??!1,onChange:Z=>{Z?(d.onOpen(),document.dispatchEvent(new CustomEvent(z))):d.onClose(),a?.(Z)},caller:E}),m=c.useMemo(()=>C?j.current?"delayed-open":"instant-open":"closed",[C]),v=c.useCallback(()=>{window.clearTimeout(g.current),g.current=0,j.current=!1,f(!0)},[f]),x=c.useCallback(()=>{window.clearTimeout(g.current),g.current=0,f(!1)},[f]),L=c.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>{j.current=!0,f(!0),g.current=0},y)},[y,f]);return c.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=0)},[]),e.jsx(Ce,{...o,children:e.jsx(ht,{scope:s,contentId:w,open:C,stateAttribute:m,trigger:l,onTriggerChange:p,onTriggerEnter:c.useCallback(()=>{d.isOpenDelayedRef.current?L():v()},[d.isOpenDelayedRef,L,v]),onTriggerLeave:c.useCallback(()=>{b?x():(window.clearTimeout(g.current),g.current=0)},[x,b]),onOpen:v,onClose:x,disableHoverableContent:b,children:n})})};xe.displayName=E;var W="TooltipTrigger",me=c.forwardRef((t,s)=>{const{__scopeTooltip:n,...r}=t,i=q(W,n),a=Y(W,n),u=U(n),h=c.useRef(null),d=ie(s,h,i.onTriggerChange),o=c.useRef(!1),l=c.useRef(!1),p=c.useCallback(()=>o.current=!1,[]);return c.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(Ne,{asChild:!0,...u,children:e.jsx(Te.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:d,onPointerMove:k(t.onPointerMove,w=>{w.pointerType!=="touch"&&!l.current&&!a.isPointerInTransitRef.current&&(i.onTriggerEnter(),l.current=!0)}),onPointerLeave:k(t.onPointerLeave,()=>{i.onTriggerLeave(),l.current=!1}),onPointerDown:k(t.onPointerDown,()=>{i.open&&i.onClose(),o.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:k(t.onFocus,()=>{o.current||i.onOpen()}),onBlur:k(t.onBlur,i.onClose),onClick:k(t.onClick,i.onClose)})})});me.displayName=W;var gt="TooltipPortal",[Zt,vt]=O(gt,{forceMount:void 0}),P="TooltipContent",he=c.forwardRef((t,s)=>{const n=vt(P,t.__scopeTooltip),{forceMount:r=n.forceMount,side:i="top",...a}=t,u=q(P,t.__scopeTooltip);return e.jsx(ke,{present:r||u.open,children:u.disableHoverableContent?e.jsx(ge,{side:i,...a,ref:s}):e.jsx(wt,{side:i,...a,ref:s})})}),wt=c.forwardRef((t,s)=>{const n=q(P,t.__scopeTooltip),r=Y(P,t.__scopeTooltip),i=c.useRef(null),a=ie(s,i),[u,h]=c.useState(null),{trigger:d,onClose:o}=n,l=i.current,{onPointerInTransitChange:p}=r,w=c.useCallback(()=>{h(null),p(!1)},[p]),g=c.useCallback((b,y)=>{const j=b.currentTarget,C={x:b.clientX,y:b.clientY},f=Nt(C,j.getBoundingClientRect()),m=Tt(C,f),v=kt(y.getBoundingClientRect()),x=Pt([...m,...v]);h(x),p(!0)},[p]);return c.useEffect(()=>()=>w(),[w]),c.useEffect(()=>{if(d&&l){const b=j=>g(j,l),y=j=>g(j,d);return d.addEventListener("pointerleave",b),l.addEventListener("pointerleave",y),()=>{d.removeEventListener("pointerleave",b),l.removeEventListener("pointerleave",y)}}},[d,l,g,w]),c.useEffect(()=>{if(u){const b=y=>{const j=y.target,C={x:y.clientX,y:y.clientY},f=d?.contains(j)||l?.contains(j),m=!Rt(C,u);f?w():m&&(w(),o())};return document.addEventListener("pointermove",b),()=>document.removeEventListener("pointermove",b)}},[d,l,u,o,w]),e.jsx(ge,{...t,ref:a})}),[bt,yt]=O(E,{isInside:!1}),jt=Se("TooltipContent"),ge=c.forwardRef((t,s)=>{const{__scopeTooltip:n,children:r,"aria-label":i,onEscapeKeyDown:a,onPointerDownOutside:u,...h}=t,d=q(P,n),o=U(n),{onClose:l}=d;return c.useEffect(()=>(document.addEventListener(z,l),()=>document.removeEventListener(z,l)),[l]),c.useEffect(()=>{if(d.trigger){const p=w=>{w.target?.contains(d.trigger)&&l()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[d.trigger,l]),e.jsx(Re,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:a,onPointerDownOutside:u,onFocusOutside:p=>p.preventDefault(),onDismiss:l,children:e.jsxs(Pe,{"data-state":d.stateAttribute,...o,...h,ref:s,style:{...h.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(jt,{children:r}),e.jsx(bt,{scope:n,isInside:!0,children:e.jsx(Xe,{id:d.contentId,role:"tooltip",children:i||r})})]})})});he.displayName=P;var ve="TooltipArrow",Ct=c.forwardRef((t,s)=>{const{__scopeTooltip:n,...r}=t,i=U(n);return yt(ve,n).isInside?null:e.jsx(Ae,{...i,...r,ref:s})});Ct.displayName=ve;function Nt(t,s){const n=Math.abs(s.top-t.y),r=Math.abs(s.bottom-t.y),i=Math.abs(s.right-t.x),a=Math.abs(s.left-t.x);switch(Math.min(n,r,i,a)){case a:return"left";case i:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function Tt(t,s,n=5){const r=[];switch(s){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function kt(t){const{top:s,right:n,bottom:r,left:i}=t;return[{x:i,y:s},{x:n,y:s},{x:n,y:r},{x:i,y:r}]}function Rt(t,s){const{x:n,y:r}=t;let i=!1;for(let a=0,u=s.length-1;a<s.length;u=a++){const h=s[a],d=s[u],o=h.x,l=h.y,p=d.x,w=d.y;l>r!=w>r&&n<(p-o)*(r-l)/(w-l)+o&&(i=!i)}return i}function Pt(t){const s=t.slice();return s.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),St(s)}function St(t){if(t.length<=1)return t.slice();const s=[];for(let r=0;r<t.length;r++){const i=t[r];for(;s.length>=2;){const a=s[s.length-1],u=s[s.length-2];if((a.x-u.x)*(i.y-u.y)>=(a.y-u.y)*(i.x-u.x))s.pop();else break}s.push(i)}s.pop();const n=[];for(let r=t.length-1;r>=0;r--){const i=t[r];for(;n.length>=2;){const a=n[n.length-1],u=n[n.length-2];if((a.x-u.x)*(i.y-u.y)>=(a.y-u.y)*(i.x-u.x))n.pop();else break}n.push(i)}return n.pop(),s.length===1&&n.length===1&&s[0].x===n[0].x&&s[0].y===n[0].y?s:s.concat(n)}var At=pe,Et=xe,Lt=me,we=he;const ne=At,ae=Et,re=Lt,V=c.forwardRef(({className:t,sideOffset:s=4,...n},r)=>e.jsx(we,{ref:r,sideOffset:s,className:_e("z-modal overflow-hidden rounded-dropdown border bg-popover px-3 py-2 text-sm text-popover-foreground shadow-dropdown animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));V.displayName=we.displayName;function It(t){if(!t)return X;switch(t.toLowerCase()){case"person":return qe;case"company":case"corporation":case"business":return Ue;case"trust":case"foundation":return Oe;case"unknown":return de;default:return X}}function Mt(t){if(!t)return"destructive";switch(t.toLowerCase()){case"person":return"default";case"company":case"corporation":case"business":return"secondary";case"trust":case"foundation":return"outline";case"unknown":return"destructive";default:return"destructive"}}function Dt({results:t,searchTerm:s="",className:n=""}){const r=t.filter(o=>o.originalText.toLowerCase().includes(s.toLowerCase())||o.firstName?.toLowerCase().includes(s.toLowerCase())||o.lastName?.toLowerCase().includes(s.toLowerCase())),i=(o,l)=>{if(!o||o==="unknown")return"-";const p=o.charAt(0).toUpperCase()+o.slice(1);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:p}),l&&e.jsxs("span",{className:`text-caption ${ee(l)}`,children:[Math.round(l*100),"%"]})]})},a=o=>{const l=_(o),p=H(o);return e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(S,{variant:"outline",className:`flex items-center gap-1 ${lt(l)}`,children:[l==="gemini"?e.jsx(le,{className:"h-3 w-3"}):e.jsx(ce,{className:"h-3 w-3"}),l==="gemini"?"AI":"Pattern"]})}),e.jsx(V,{children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-semibold mb-1",children:l==="gemini"?"Gemini AI Parsing":"Pattern-based Fallback"}),e.jsx("p",{className:"text-xs",children:l==="gemini"?"Processed using advanced AI for intelligent name parsing":"Processed using rule-based pattern matching as fallback"}),p?.reason&&e.jsx("p",{className:"text-caption mt-1 text-muted-foreground",children:se(p.reason)})]})})]})})},u=o=>{const l=H(o);if(!l)return null;const p=l.level==="error"?Fe:l.level==="warning"?A:Q;return e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsx(re,{children:e.jsx(p,{className:`h-4 w-4 ${te(l.level)}`})}),e.jsx(V,{children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:`font-semibold mb-1 ${te(l.level)}`,children:l.message}),l.reason&&e.jsx("p",{className:"text-caption text-muted-foreground",children:se(l.reason)}),l.confidence&&e.jsxs("p",{className:"text-caption mt-1",children:["Confidence: ",Math.round(l.confidence*100),"%"]})]})})]})})},h=o=>{const l=H(o);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:ee(o.parsingConfidence),children:[Math.round(o.parsingConfidence*100),"%"]}),l&&u(o)]})},d=r.slice(0,100);return e.jsx("div",{className:`space-y-4 ${n}`,children:e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(st,{children:[e.jsx(nt,{children:e.jsxs(K,{children:[e.jsx(N,{children:"Original Text"}),e.jsx(N,{children:"First Name"}),e.jsx(N,{children:"Last Name"}),e.jsx(N,{children:"Entity Type"}),e.jsx(N,{children:"Gender"}),e.jsx(N,{children:"Method"}),e.jsx(N,{children:"Confidence"})]})}),e.jsx(at,{children:d.map((o,l)=>e.jsxs(K,{className:_(o)==="fallback"?"bg-status-warning-bg/30":"",children:[e.jsx(T,{className:"font-medium max-w-xs",children:e.jsx("div",{className:"truncate",title:o.originalText,children:o.originalText})}),e.jsx(T,{children:o.firstName||"-"}),e.jsx(T,{children:o.lastName||"-"}),e.jsx(T,{children:e.jsxs(S,{variant:Mt(o.entityType),className:"flex items-center gap-1 w-fit",children:[(()=>{const p=It(o.entityType);return e.jsx(p,{className:"h-4 w-4"})})(),o.entityType]})}),e.jsx(T,{children:i(o.gender,o.genderConfidence)}),e.jsx(T,{children:a(o)}),e.jsx(T,{children:h(o)})]},l))})]}),r.length>100&&e.jsxs("div",{className:"p-4 text-center text-sm text-muted-foreground border-t bg-muted/20",children:["Showing first 100 results of ",r.length.toLocaleString()," total. Download the full file to see all results."]}),r.length===0&&e.jsx(ue,{icon:Q,title:"No results found",description:s?"No results match your search criteria":"No results available for this job",size:"md"})]})})}function Xt(){const[t]=Ee(),[s,n]=c.useState([]),[r,i]=c.useState(null),[a,u]=c.useState([]),[h,d]=c.useState([]),[o,l]=c.useState(""),[p,w]=c.useState(!0),g=t.get("jobId"),b=c.useCallback(async()=>{try{const m=(await F.getJobs()).filter(v=>v.status==="completed");if(n(m),g){const v=m.find(x=>x.id===g);v&&i(v)}else m.length>0&&i(m[0])}catch{R.error("Failed to fetch completed jobs")}finally{w(!1)}},[g]),y=async f=>{try{const v=(await F.getJobResults(f,100)).results.map((x,L)=>({id:L.toString(),originalText:x.original_name_text||"",firstName:x.first_name||"",lastName:x.last_name||"",entityType:x.entity_type||"unknown",parsingConfidence:x.parsing_confidence||0,gender:x.gender||"unknown",genderConfidence:x.gender_confidence||0,parsingMethod:x.parsing_method||"unknown",hasWarnings:x.has_warnings||!1,warnings:x.warnings?x.warnings.split(","):[],geminiUsed:x.gemini_used||!1,fallbackReason:x.fallback_reason||null}));u(v)}catch(m){Ge.error("Failed to fetch job results:",m);const v=m;v?.response?.status===404?R.error("Results file has expired and been deleted. Please process the file again."):v?.response?.status===400?R.error("Job is not completed yet or has failed processing."):R.error("Failed to fetch job results. The file may have expired."),u([])}},j=c.useCallback(()=>{if(!o){d(a);return}const f=a.filter(m=>m.originalText.toLowerCase().includes(o.toLowerCase())||m.firstName?.toLowerCase().includes(o.toLowerCase())||m.lastName?.toLowerCase().includes(o.toLowerCase()));d(f)},[a,o]);c.useEffect(()=>{b()},[b]),c.useEffect(()=>{r&&y(r.id)},[r]),c.useEffect(()=>{j()},[j]);const C=async f=>{try{const m=await F.downloadResults(f.id),v=window.URL.createObjectURL(m),x=document.createElement("a");x.style.display="none",x.href=v,x.download=`processed_${f.filename}`,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(v),document.body.removeChild(x),R.success("File downloaded successfully")}catch{R.error("Failed to download file")}};return p?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Results"}),e.jsx(rt,{variant:"card",showHeader:!0,rows:5})]}):s.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Results"}),e.jsx(M,{children:e.jsx(ue,{icon:de,title:"No completed jobs",description:"Complete processing jobs will appear here for viewing and download",size:"lg",showBranding:!0})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Results"}),e.jsx("p",{className:"text-muted-foreground",children:"View and download your processed file results"})]}),e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Select Job"}),e.jsx(B,{children:"Choose a completed job to view results"})]}),e.jsx(J,{children:e.jsx("div",{className:"grid gap-2 md:grid-cols-2 lg:grid-cols-3",children:s.map(f=>{const m=f.expiresAt&&new Date(f.expiresAt)<new Date,v=f.expiresAt&&!m&&new Date(f.expiresAt).getTime()-new Date().getTime()<120*1e3;return e.jsx(D,{variant:r?.id===f.id?"default":"outline",className:`justify-start h-auto p-4 relative ${m?"opacity-50":""}`,onClick:()=>i(f),children:e.jsxs("div",{className:"text-left w-full",children:[e.jsx("p",{className:"font-medium truncate",children:f.filename}),e.jsx("p",{className:"text-caption text-muted-foreground",children:new Date(f.completedAt).toLocaleDateString()}),e.jsxs("p",{className:"text-caption text-muted-foreground",children:[f.totalRows?.toLocaleString()," rows"]}),m&&e.jsxs("div",{className:"flex items-center gap-1 text-caption text-status-error mt-1",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:"Expired"})]}),!m&&v&&e.jsxs("div",{className:"flex items-center gap-1 text-caption text-status-warning mt-1",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:"Expiring soon"})]})]})},f.id)})})})]}),r&&e.jsxs(M,{children:[r.expiresAt&&e.jsx("div",{className:"border-b",children:e.jsx("div",{className:"p-4 bg-status-warning-bg",children:e.jsx(Be,{expiresAt:r.expiresAt,className:"w-full",showIcon:!0,warningThreshold:5})})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(G,{children:r.filename}),e.jsxs(B,{children:["Processing completed ",new Date(r.completedAt).toLocaleString()]})]}),e.jsxs(D,{onClick:()=>C(r),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Download"]})]})}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ke,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx($e,{placeholder:"Search results...",value:o,onChange:f=>l(f.target.value),className:"pl-9"})]}),e.jsxs(D,{variant:"outline",size:"sm",children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),a.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:a.filter(f=>f.entityType==="person").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"People"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-info",children:a.filter(f=>f.entityType==="company").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Companies"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-success",children:a.filter(f=>f.entityType==="trust").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trusts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-warning",children:[Math.round(a.reduce((f,m)=>f+m.parsingConfidence,0)/a.length*100),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Confidence"})]})]}),e.jsx(pt,{results:a,job:r}),a.length>0?e.jsx(Dt,{results:a,searchTerm:o}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"No results available for this job"})})]})]})]})}export{Xt as default};
//# sourceMappingURL=Results-BHeVVC_o.js.map
