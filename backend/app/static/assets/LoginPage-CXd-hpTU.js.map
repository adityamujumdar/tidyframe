{"version":3,"file":"LoginPage-CXd-hpTU.js","sources":["../../src/pages/auth/LoginPage.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { Link, Navigate, useLocation, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Loader2, Mail, Lock, Eye, EyeOff } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\nexport default function LoginPage() {\r\n  const { user, login, hasActiveSubscription, checkSubscriptionStatus } = useAuth();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  // Redirect if already authenticated\r\n  if (user) {\r\n    // Check if user has active subscription or is enterprise\r\n    if (user.plan === 'enterprise' || hasActiveSubscription) {\r\n      const from = (location.state as { from?: { pathname: string } })?.from?.pathname || '/dashboard';\r\n      return <Navigate to={from} replace />;\r\n    } else {\r\n      // No active subscription, redirect to pricing\r\n      return <Navigate to=\"/pricing\" replace />;\r\n    }\r\n  }\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      await login(email, password);\r\n      toast.success('Login successful!');\r\n      \r\n      // Check subscription status after login\r\n      const hasSubscription = await checkSubscriptionStatus();\r\n      if (hasSubscription) {\r\n        const from = (location.state as { from?: { pathname: string } })?.from?.pathname || '/dashboard';\r\n        navigate(from, { replace: true });\r\n      } else {\r\n        // No active subscription, redirect to pricing\r\n        navigate('/pricing', { replace: true });\r\n        toast.info('Please complete your subscription to access all features.');\r\n      }\r\n    } catch (err: unknown) {\r\n      const errorMessage = err instanceof Error && 'response' in err && \r\n        err.response && typeof err.response === 'object' && \r\n        'data' in err.response && \r\n        err.response.data && typeof err.response.data === 'object' && \r\n        'message' in err.response.data && \r\n        typeof err.response.data.message === 'string'\r\n        ? err.response.data.message\r\n        : 'Login failed. Please try again.';\r\n      setError(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-background px-4\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader className=\"text-center\">\r\n          <div className=\"flex justify-center mb-4\">\r\n            <Link to=\"/\">\r\n              <img src=\"/logo-with-name.png\" alt=\"TidyFrame\" className=\"h-29\" />\r\n            </Link>\r\n          </div>\r\n          <CardTitle className=\"text-2xl font-bold\">Welcome back</CardTitle>\r\n          <CardDescription>\r\n            Sign in to your tidyframe.com account\r\n          </CardDescription>\r\n        </CardHeader>\r\n        \r\n        <form onSubmit={handleSubmit}>\r\n          <CardContent className=\"space-y-4\">\r\n            {error && (\r\n              <Alert variant=\"destructive\">\r\n                <AlertDescription>{error}</AlertDescription>\r\n              </Alert>\r\n            )}\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"email\">Email</Label>\r\n              <div className=\"relative\">\r\n                <Mail className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  id=\"email\"\r\n                  type=\"email\"\r\n                  placeholder=\"Enter your email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  className=\"pl-9\"\r\n                  required\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"password\">Password</Label>\r\n              <div className=\"relative\">\r\n                <Lock className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  id=\"password\"\r\n                  type={showPassword ? 'text' : 'password'}\r\n                  placeholder=\"Enter your password\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  className=\"pl-9 pr-9\"\r\n                  required\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowPassword(!showPassword)}\r\n                  className=\"absolute right-3 top-3 text-muted-foreground hover:text-foreground\"\r\n                >\r\n                  {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex justify-end\">\r\n              <Link\r\n                to=\"/auth/reset-password\"\r\n                className=\"text-sm text-primary hover:underline\"\r\n              >\r\n                Forgot password?\r\n              </Link>\r\n            </div>\r\n          </CardContent>\r\n          \r\n          <CardFooter className=\"flex flex-col space-y-4\">\r\n            <Button type=\"submit\" className=\"w-full\" disabled={loading}>\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                  Signing in...\r\n                </>\r\n              ) : (\r\n                'Sign in'\r\n              )}\r\n            </Button>\r\n\r\n            <p className=\"text-center text-sm text-muted-foreground\">\r\n              Don't have an account?{' '}\r\n              <Link to=\"/auth/register\" className=\"text-primary hover:underline\">\r\n                Sign up\r\n              </Link>\r\n            </p>\r\n          </CardFooter>\r\n        </form>\r\n      </Card>\r\n    </div>\r\n  );\r\n}"],"names":["LoginPage","user","login","hasActiveSubscription","checkSubscriptionStatus","useAuth","location","useLocation","navigate","useNavigate","email","setEmail","useState","password","setPassword","showPassword","setShowPassword","loading","setLoading","error","setError","from","jsx","Navigate","handleSubmit","e","toast","err","errorMessage","jsxs","Card","CardHeader","Link","CardTitle","CardDescription","CardContent","Alert","AlertDescription","Label","Mail","Input","Lock","EyeOff","Eye","CardFooter","Button","Fragment","Loader2"],"mappings":"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"}