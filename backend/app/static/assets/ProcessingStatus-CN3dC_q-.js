import{j as s}from"./ui-CDVFbD1c.js";import{e as U,u as E,r as m,L as N}from"./router-Cc-HybBK.js";import{l as F,u as B,s as h,t as x,C as j,d as b,B as g,R as Z,F as S,j as A,a as z,b as V,c as H,y as Q,z as O,G as q,Z as G,A as R,m as M,e as k,D as W,J as K}from"./index-CKLB544Z.js";import{C as X,M as o}from"./MetricCard-CzCtxWTo.js";import{S as I}from"./StatusIndicator-C-u2FwoU.js";import{P as Y}from"./ProgressBar-1GlzJVtV.js";import{a as J,b as ee}from"./format-CI9fAwaI.js";import{C as se}from"./circle-check-big-FM2aPciw.js";import{T as te}from"./trash-2-CFOsYl8f.js";import"./vendor-9sitkZcQ.js";import"./clock-DgkDdPmv.js";import"./status-CeMZWd8W.js";import"./trending-up-bdmEY9HE.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],le=F("scale",ae);function P(i,a,d=0){if(i==null&&(i=0),a==null&&(a=0),a===0)return 0;const f=i/a*100;return re(ce(f,d),0,100)}function re(i,a,d){return Math.min(Math.max(i,a),d)}function ce(i,a=0){const d=Math.pow(10,a);return Math.round(i*d)/d}function ye(){const[i]=U(),a=E(),{user:d}=B(),[f,p]=m.useState([]),[T,w]=m.useState(!0),[C,v]=m.useState(!1),n=m.useRef(null),l=i.get("jobId"),r=!d;m.useEffect(()=>{r&&!l&&a("/")},[r,l,a]);const y=m.useCallback(async(e=!1)=>{e||w(!0),v(!e);try{const t=await h.getJobs();p(t),l&&!e&&setTimeout(()=>{const u=document.getElementById(`job-${l}`);u&&u.scrollIntoView({behavior:"smooth"})},100)}catch{x.error("Failed to fetch job status")}finally{w(!1),v(!1)}},[l]),_=m.useCallback(async(e=!1)=>{if(l){e||w(!0),v(!e);try{const t=await h.getJobStatus(l);p([t])}catch{x.error("Failed to fetch job status"),r&&setTimeout(()=>a("/"),2e3)}finally{w(!1),v(!1)}}},[l,r,a]);m.useEffect(()=>{if(r&&!l)return;r&&l?_():y();const e=setInterval(async()=>{try{if(r&&l){const t=await h.getJobStatus(l);p([t]),(t.status==="completed"||t.status==="failed")&&n.current&&(clearInterval(n.current),n.current=null)}else{const t=await h.getJobs();p(t),!t.some(c=>c.status==="processing"||c.status==="pending")&&n.current&&(clearInterval(n.current),n.current=null)}}catch{}},2e3);return n.current=e,()=>{n.current&&clearInterval(n.current)}},[r,l,y,_]);const $=async e=>{try{const t=await h.downloadResults(e.id),u=window.URL.createObjectURL(t),c=document.createElement("a");c.style.display="none",c.href=u,c.download=`processed_${e.filename}`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(u),document.body.removeChild(c),x.success("File downloaded successfully")}catch{x.error("Failed to download file")}},D=async e=>{try{await h.deleteJob(e.id),p(f.filter(t=>t.id!==e.id)),x.success("Job deleted successfully")}catch{x.error("Failed to delete job")}},L=e=>{if(e.status!=="processing")return"";const t=Date.now()-new Date(e.createdAt).getTime(),u=(e.totalRows||1e3)*50,c=Math.max(0,u-t);return ee(c)};return T?s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Processing Status"})}),s.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,t)=>s.jsx(j,{className:"animate-pulse",children:s.jsx(b,{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-1/3"}),s.jsx("div",{className:"h-6 bg-muted rounded w-full"}),s.jsx("div",{className:"h-2 bg-muted rounded w-full"})]})})},t))})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Processing Status"}),s.jsx("p",{className:"text-muted-foreground",children:"Monitor your file processing jobs and download results. All files are automatically deleted after 10 minutes."})]}),s.jsxs(g,{onClick:()=>y(),disabled:C,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[s.jsx(Z,{className:`h-4 w-4 mr-2 ${C?"animate-spin":""}`}),"Refresh"]})]}),f.length===0?s.jsx(j,{children:s.jsxs(b,{className:"p-12 text-center",children:[s.jsx(S,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No processing jobs"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload your first file to start processing names with AI"}),s.jsx(N,{to:"/dashboard/upload",children:s.jsx(g,{children:"Upload File"})})]})}):s.jsx("div",{className:"space-y-4",children:f.map(e=>s.jsxs(j,{id:`job-${e.id}`,className:A("border-2 transition-all duration-normal",l===e.id&&"ring-2 ring-primary",e.status==="completed"&&"border-l-4 border-l-green-500/50 shadow-md",e.status==="processing"&&"border-l-4 border-l-blue-500 ring-2 ring-blue-500/20",e.status==="failed"&&"border-l-4 border-l-red-500/50"),role:"article","aria-label":`Processing job for ${e.filename}, ${e.status}, ${e.progress}% complete`,children:[s.jsxs(z,{children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(I,{status:e.status,mode:"icon",iconSize:"lg",animate:!0}),s.jsxs("div",{children:[s.jsx(V,{className:"text-lg sm:text-xl",children:e.filename}),s.jsxs(H,{children:["Uploaded ",J(e.createdAt),e.completedAt&&e.status==="completed"&&s.jsxs("span",{children:[" • Completed ",J(e.completedAt)]})]})]})]}),s.jsx(I,{status:e.status,mode:"badge"})]}),(e.expiresAt||e.expires_at)&&s.jsx("div",{className:"mt-4",children:s.jsx(X,{expiresAt:e.expiresAt||e.expires_at||null,className:"w-full",showIcon:!0,warningThreshold:2})})]}),s.jsxs(b,{className:"space-y-4",children:[s.jsx(Y,{value:e.progress,max:100,showLabel:!0,label:`Progress: ${e.progress}%${e.status==="processing"?` • ${L(e)}`:""}`,animated:e.status==="processing",dangerZone:95}),s.jsxs("div",{className:A("grid gap-3 sm:gap-4 text-sm",r?"grid-cols-1 sm:grid-cols-2":"grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"),children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-muted-foreground",children:"Rows"}),s.jsx("p",{className:"font-semibold",children:e.totalRows?e.totalRows.toLocaleString():e.processedRows?e.processedRows.toLocaleString():"Processing..."})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-muted-foreground",children:"Success Rate"}),s.jsx("p",{className:"font-semibold",children:e.status==="completed"&&(e.successRate!==void 0||e.totalRows&&e.successfulParses!==void 0)?`${e.successRate!==void 0?Math.round(e.successRate):Math.round((e.successfulParses||0)/(e.totalRows||1)*100)}%`:"-"})]}),!r&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-muted-foreground",children:"Processed"}),s.jsx("p",{className:"font-semibold",children:e.processedRows?e.processedRows.toLocaleString():"-"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-muted-foreground",children:"Job ID"}),s.jsxs("p",{className:"font-mono text-caption",children:[e.id.slice(0,8),"..."]})]})]})]}),!r&&e.status==="completed"&&e.analytics&&s.jsxs("div",{className:"border-t pt-6 mt-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-4",children:"Entity Type Analytics"}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4",children:[s.jsx(o,{value:e.analytics.entity_stats?.person_count||0,label:"People",variant:"info",icon:Q}),s.jsx(o,{value:e.analytics.entity_stats?.company_count||0,label:"Companies",variant:"success",icon:O}),s.jsx(o,{value:e.analytics.entity_stats?.trust_count||0,label:"Trusts",variant:"default",icon:le}),s.jsx(o,{value:e.analytics.entity_stats?.unknown_count||0,label:"Unknown",variant:"warning"}),s.jsx(o,{value:e.analytics.entity_stats?.error_count||0,label:"Errors",variant:"error"})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-4",children:"Quality & Method Analytics"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[s.jsx(o,{value:`${P(e.geminiSuccessCount,e.totalRows)}%`,label:"AI Success",variant:"info",icon:q,formatValue:!1}),s.jsx(o,{value:`${P(e.fallbackUsageCount,e.totalRows)}%`,label:"Fallback Used",variant:"warning",icon:G,formatValue:!1}),s.jsx(o,{value:e.analytics.high_confidence_count||0,label:"High Quality",variant:"success",icon:se}),s.jsx(o,{value:e.analytics.avg_confidence?Math.round(e.analytics.avg_confidence*100):0,label:"Quality Score",variant:"info"})]})]}),e.analytics.low_confidence_count&&e.totalRows&&e.analytics.low_confidence_count/e.totalRows>.3&&s.jsxs(R,{variant:"default",children:[s.jsx(M,{className:"h-4 w-4"}),s.jsxs(k,{children:["High fallback usage detected (",Math.round(e.analytics.low_confidence_count/e.totalRows*100),"%). Consider checking the detailed results for quality concerns."]})]})]}),e.status==="failed"&&e.errorMessage&&s.jsxs(R,{variant:"destructive",children:[s.jsx(M,{className:"h-4 w-4"}),s.jsx(k,{children:e.errorMessage})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.status==="completed"&&s.jsxs(g,{onClick:()=>$(e),variant:"success",size:"default",className:"w-full sm:w-auto shadow-lg",children:[s.jsx(W,{className:"h-4 w-4 mr-2"}),"Download Results"]}),e.status==="completed"&&!r&&s.jsx(N,{to:`/dashboard/results?jobId=${e.id}`,className:"w-full sm:w-auto",children:s.jsxs(g,{variant:"secondary",className:"w-full border border-primary-200 hover:border-primary-400",children:[s.jsx(S,{className:"h-4 w-4 mr-2"}),"View Results"]})}),(e.status==="failed"||e.status==="completed")&&!r&&s.jsxs(g,{variant:"outline",onClick:()=>D(e),className:"w-full sm:w-auto text-destructive hover:text-destructive",children:[s.jsx(te,{className:"h-4 w-4 mr-2"}),"Delete"]})]}),r&&e.status==="completed"&&s.jsxs(R,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[s.jsx(K,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),s.jsxs(k,{className:"text-center",children:[s.jsx("span",{className:"text-foreground",children:"Want to process more files? "}),s.jsx(N,{to:"/auth/register",className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-semibold underline underline-offset-2",children:"Sign up for 100,000 parses/month"})]})]})]})]})]},e.id))})]})}export{ye as default};
//# sourceMappingURL=ProcessingStatus-CN3dC_q-.js.map
