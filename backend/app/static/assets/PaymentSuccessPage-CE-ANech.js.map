{"version":3,"file":"PaymentSuccessPage-CE-ANech.js","sources":["../../src/pages/payment/PaymentSuccessPage.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { logger } from '@/utils/logger';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { CheckCircle, Loader2 } from 'lucide-react';\r\n\r\nexport default function PaymentSuccessPage() {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const { user, refreshUser } = useAuth();\r\n  const [activating, setActivating] = useState(true);\r\n  const [activated, setActivated] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const activateUser = async () => {\r\n      try {\r\n        // Check if user is already activated\r\n        if (user) {\r\n          logger.debug('User already active, redirecting to dashboard');\r\n          setActivated(true);\r\n          setTimeout(() => {\r\n            navigate('/dashboard/upload?payment_success=true', { replace: true });\r\n          }, 1500);\r\n          return;\r\n        }\r\n\r\n        // Extract pending user from localStorage\r\n        const pendingUserStr = localStorage.getItem('pending_user');\r\n        const registrationComplete = localStorage.getItem('registration_complete');\r\n\r\n        if (!pendingUserStr || !registrationComplete) {\r\n          logger.error('No pending user found, redirecting to login');\r\n          navigate('/auth/login', { replace: true });\r\n          return;\r\n        }\r\n\r\n        const pendingUser = JSON.parse(pendingUserStr);\r\n        logger.debug('Activating pending user:', pendingUser.email);\r\n\r\n        // Simulate activation delay for UX (webhook processing)\r\n        await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n        // Activate user by fetching current user data with stored token\r\n        const token = localStorage.getItem('token');\r\n        if (token) {\r\n          logger.debug('Activating user with stored token');\r\n          try {\r\n            await refreshUser();\r\n            logger.debug('User activated successfully');\r\n          } catch (error) {\r\n            logger.error('Failed to refresh user, continuing anyway:', error);\r\n            // Continue even if refresh fails - user has valid token\r\n          }\r\n        }\r\n\r\n        // Clean up localStorage\r\n        localStorage.removeItem('pending_user');\r\n        localStorage.removeItem('registration_complete');\r\n\r\n        // Mark as activated\r\n        setActivated(true);\r\n        setActivating(false);\r\n\r\n        // Redirect to upload page with payment success flag for grace period\r\n        setTimeout(() => {\r\n          navigate('/dashboard/upload?payment_success=true', { replace: true });\r\n        }, 1500);\r\n\r\n      } catch (error) {\r\n        logger.error('Error activating user:', error);\r\n        // On error, still try to redirect - user has valid tokens\r\n        setTimeout(() => {\r\n          navigate('/dashboard?payment_success=true', { replace: true });\r\n        }, 2000);\r\n      }\r\n    };\r\n\r\n    activateUser();\r\n  }, [user, navigate]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-background px-4\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader className=\"text-center\">\r\n          <div className=\"flex justify-center mb-4\">\r\n            {activated ? (\r\n              <CheckCircle className=\"h-16 w-16 text-success animate-in zoom-in duration-500\" />\r\n            ) : (\r\n              <Loader2 className=\"h-16 w-16 text-primary animate-spin\" />\r\n            )}\r\n          </div>\r\n          <CardTitle className=\"text-2xl font-bold\">\r\n            {activated ? 'Payment Successful!' : 'Processing Your Payment'}\r\n          </CardTitle>\r\n          <CardDescription>\r\n            {activated\r\n              ? 'Your account is now active. Redirecting you to start processing...'\r\n              : 'Please wait while we activate your account...'}\r\n          </CardDescription>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"space-y-4 text-center\">\r\n          {!activated && (\r\n            <div className=\"space-y-2\">\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Thank you for subscribing to TidyFrame!\r\n              </p>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                We're setting up your account with 100,000 monthly name parses.\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {activated && (\r\n            <div className=\"space-y-2\">\r\n              <p className=\"text-sm font-medium text-success\">\r\n                ✓ Account activated\r\n              </p>\r\n              <p className=\"text-sm font-medium text-success\">\r\n                ✓ 100,000 monthly parses ready\r\n              </p>\r\n              <p className=\"text-sm font-medium text-success\">\r\n                ✓ Redirecting to upload...\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {activating && !activated && (\r\n            <div className=\"flex items-center justify-center space-x-2 text-xs text-muted-foreground\">\r\n              <Loader2 className=\"h-3 w-3 animate-spin\" />\r\n              <span>This may take a few seconds...</span>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["PaymentSuccessPage","navigate","useNavigate","useSearchParams","user","refreshUser","useAuth","activating","setActivating","useState","activated","setActivated","useEffect","logger","pendingUserStr","registrationComplete","pendingUser","resolve","error","jsxs","Card","CardHeader","jsx","CheckCircle","Loader2","CardTitle","CardDescription","CardContent"],"mappings":"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"}